const userCategories = new Map();

// –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
const categories = [
  { id: 'driver', name: 'üöó –í–æ–¥—ñ–π', description: '–†–æ–±–æ—Ç–∞ –≤–æ–¥—ñ—î–º' },
  { id: 'cleaner', name: 'üßπ –ö–ª—ñ–Ω–µ—Ä', description: '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è' },
  { id: 'hr', name: 'üìã HR', description: '–í—ñ–¥–¥—ñ–ª –∫–∞–¥—Ä—ñ–≤' },
  { id: 'manager', name: 'üëî –ú–µ–Ω–µ–¥–∂–µ—Ä', description: '–£–ø—Ä–∞–≤–ª—ñ–Ω—Å—å–∫–∞ –ø–æ—Å–∞–¥–∞' },
  { id: 'smm', name: 'üì± SMM', description: '–°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ —Ç–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥' },
  { id: 'storekeeper', name: 'üì¶ –ö–æ–º—ñ—Ä–Ω–∏–∫', description: '–°–∫–ª–∞–¥—Å—å–∫–∞ —Ä–æ–±–æ—Ç–∞' },
  { id: 'mall_worker', name: 'üè¢ –ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫ –¢–†–¶', description: '–†–æ–±–æ—Ç–∞ —É —Ç–æ—Ä–≥–æ–≤–æ–º—É —Ü–µ–Ω—Ç—Ä—ñ' }
];

// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const categoryInfo = {
  driver: `üöó *–í–æ–¥—ñ–π –Ω–∞ –∞–≤—Ç–æ —Ñ—ñ—Ä–º–∏*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 1200 –≥—Ä–Ω –∑–∞ –∑–º—ñ–Ω—É
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* –î–≤–∞ —Ä–∞–∑–∏ –Ω–∞ –º—ñ—Å—è—Ü—å: –∞–≤–∞–Ω—Å 15-–≥–æ, –∑–∞—Ä–ø–ª–∞—Ç–∞ 8-–≥–æ
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* –ù–∞ –≤–∏–±—ñ—Ä - 3/2 –∞–±–æ 5/2
*üìç –°–∫–ª–∞–¥:* –í–µ–ª–∏–∫–∞ –∫—ñ–ª—å—Ü–µ–≤–∞, 4–≥
*üöô –ê–≤—Ç–æ:* –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏–π Nissan E-NV200 (–µ–ª–µ–∫—Ç—Ä–æ–∫–∞—Ä)
*üéΩ –§–æ—Ä–º–∞:* –¢–∞–∫, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ —Ñ–æ—Ä–º–∞
*üìö –°—Ç–∞–∂—É–≤–∞–Ω–Ω—è:* –¢–∞–∫, –∑ –Ω–∞–≤—á–∞–Ω–Ω—è–º –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ä–æ–±–æ—Ç–∏

*‚ÑπÔ∏è –£–º–æ–≤–∏:*
‚Ä¢ –ö–æ–º–ø–∞–Ω—ñ—è –Ω–∞–¥–∞—î –∞–≤—Ç–æ
‚Ä¢ –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ –≤–ª–∞—Å–Ω–µ –∞–≤—Ç–æ
‚Ä¢ –ü–ª–∞–≤–Ω–µ –≤–≤–µ–¥–µ–Ω–Ω—è –≤ —Ä–æ–±–æ—á—ñ –ø—Ä–æ—Ü–µ—Å–∏`,

  cleaner: `üßπ *–ö–ª—ñ–Ω–µ—Ä-—É–Ω—ñ–≤–µ—Ä—Å–∞–ª*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 1100‚Äì1500 –≥—Ä–Ω –∑–∞ –∑–º—ñ–Ω—É + —á–∞–π–æ–≤—ñ (–¥–æ 8000 –≥—Ä–Ω/–º—ñ—Å)
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* –î–≤–∞ —Ä–∞–∑–∏ –Ω–∞ –º—ñ—Å—è—Ü—å: –∞–≤–∞–Ω—Å 15-–≥–æ, –∑–∞—Ä–ø–ª–∞—Ç–∞ 8-–≥–æ
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* –ó–º—ñ–Ω–∏ –ø–æ 2/2, –ø–æ–≤–Ω–∏–π –¥–µ–Ω—å
*üìç –û—Ñ—ñ—Å –¥–ª—è —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üéΩ –§–æ—Ä–º–∞:* –¢–∞–∫, –∫–æ–º–ø–∞–Ω—ñ—è –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ–≤–Ω—ñ—Å—Ç—é
*üõ†Ô∏è –Ü–Ω–≤–µ–Ω—Ç–∞—Ä:* –ü–æ–≤–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Ç —Ö—ñ–º—ñ—ó —Ç–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è
*üìö –ù–∞–≤—á–∞–Ω–Ω—è:* –°—Ç–∞–∂—É–≤–∞–Ω–Ω—è 2-3 –¥–Ω—ñ (–æ–ø–ª–∞—á—É–≤–∞–Ω–µ)

*‚ÑπÔ∏è –£–º–æ–≤–∏:*
‚Ä¢ –ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –∫–≤–∞—Ä—Ç–∏—Ä, –æ—Ñ—ñ—Å—ñ–≤
‚Ä¢ –ú–æ–∂–ª–∏–≤—ñ –≤–∏—ó–∑–¥–∏ –Ω–∞ —Ö—ñ–º—á–∏—Å—Ç–∫—É
‚Ä¢ –ù–∞–≤—á–∞–Ω–Ω—è –∑ –Ω—É–ª—è
‚Ä¢ –ß–∞–π–æ–≤—ñ –≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç—ñ–≤ + –ø—Ä–µ–º—ñ—ó`,

  hr: `üìã *HR (–ø–æ—à—É–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤)*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 25 000 –≥—Ä–Ω/–º—ñ—Å
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* 15-–≥–æ –∞–≤–∞–Ω—Å, 8-–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* 2 –¥–Ω—ñ –≤ –æ—Ñ—ñ—Å—ñ (10:00‚Äì18:00) + 2 –¥–Ω—ñ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ
*üìç –û—Ñ—ñ—Å:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üìù –ó–∞–≤–¥–∞–Ω–Ω—è:* –ü–æ—à—É–∫ —ñ –≤—ñ–¥–±—ñ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª—É, —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏
*üë• –ì—Ä—É–ø–∏:* –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≥—Ä—É–ø –Ω–∞ —Å—Ç–∞–∂—É–≤–∞–Ω–Ω—è
*üìã –í–∏–ø—Ä–æ–±—É–≤–∞–ª—å–Ω–∏–π:* –¢–∞–∫, –ø–µ—Ä—à–∏–π –º—ñ—Å—è—Ü—å - –∞–¥–∞–ø—Ç–∞—Ü—ñ–π–Ω–∏–π

*‚ÑπÔ∏è –£–º–æ–≤–∏:*
‚Ä¢ –ú–æ–ª–æ–¥–∞ –∫–æ–º–∞–Ω–¥–∞, –¥—Ä—É–∂–Ω—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞
‚Ä¢ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ —Ä–æ—Å—Ç—É –¥–æ –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞ –≤—ñ–¥–¥—ñ–ª—É
‚Ä¢ –†–æ–±–æ—Ç–∞ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ –ø–æ—à—É–∫—É`,

  manager: `üëî *–ú–µ–Ω–µ–¥–∂–µ—Ä –±—Ä–∏–≥–∞–¥*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 35‚Äì40 —Ç–∏—Å –≥—Ä–Ω/–º—ñ—Å
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* 15-–≥–æ –∞–≤–∞–Ω—Å, 8-–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* –ù–∞ –≤–∏–±—ñ—Ä - 3/2 –∞–±–æ 5/2
*üìç –û—Ñ—ñ—Å:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:* –ö–æ–º–ø–∞–Ω—ñ—è –∑–∞–±–µ–∑–ø–µ—á—É—î –∑ –≤–æ–¥—ñ—î–º
*üìö –ù–∞–≤—á–∞–Ω–Ω—è:* –°—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–æ–º–ø–∞–Ω—ñ—ó —Ç–∞ —Ä–æ–±–æ—Ç—ñ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
*üéØ –ë–æ–Ω—É—Å–∏:* –ü—Ä–µ–º—ñ—ó –∑–∞ —è–∫—ñ—Å–Ω—É —Ä–æ–±–æ—Ç—É

*‚ÑπÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è:*
‚Ä¢ –ö–µ—Ä—É–≤–∞–Ω–Ω—è –±—Ä–∏–≥–∞–¥–æ—é
‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å —è–∫–æ—Å—Ç—ñ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
‚Ä¢ –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–∏—ó–∑–¥—ñ–≤
‚Ä¢ –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
‚Ä¢ –†–æ–±–æ—Ç–∞ –∑ –≤—ñ–¥–≥—É–∫–∞–º–∏`,

  smm: `üì± *SMM-–º–µ–Ω–µ–¥–∂–µ—Ä*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 10 000 –≥—Ä–Ω/–º—ñ—Å
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* 15-–≥–æ –∞–≤–∞–Ω—Å, 8-–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* 1 –≤–∏—ó–∑–¥ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å + –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ
*üìç –û—Ñ—ñ—Å:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üì∏ –ö–æ–Ω—Ç–µ–Ω—Ç:* –ü–æ—Å—Ç–∏, Reels, Stories
*üìä –ê–∫–∞—É–Ω—Ç–∏:* 
‚Ä¢ Clean–ß–∏—Å—Ç–≤—É–¥ (Instagram)
‚Ä¢ Mr.Chistwood (Instagram)
*üé® –ü–æ—Ä—Ç—Ñ–æ–ª—ñ–æ:* –ë–∞–∂–∞–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏

*‚ÑπÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è:*
‚Ä¢ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
‚Ä¢ –†–æ–±–æ—Ç–∞ –∑ –∞—É–¥–∏—Ç–æ—Ä—ñ—î—é
‚Ä¢ –ü—Ä–æ—Å—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫
‚Ä¢ –ó–π–æ–º–∫–∞ –Ω–∞ –ª–æ–∫–∞—Ü—ñ—è—Ö
‚Ä¢ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ —Ä–æ—Å—Ç—É`,

  storekeeper: `üì¶ *–ö–æ–º—ñ—Ä–Ω–∏–∫*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* 12 000 –≥—Ä–Ω/–º—ñ—Å
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* 15-–≥–æ –∞–≤–∞–Ω—Å, 8-–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* –©–æ–¥–Ω—è 07:00-11:00 (4 –≥–æ–¥–∏–Ω–∏)
*üìç –°–∫–ª–∞–¥:* –í–µ–ª–∏–∫–∞ –∫—ñ–ª—å—Ü–µ–≤–∞, 4–≥
*üìç –û—Ñ—ñ—Å –¥–ª—è —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üìö –ù–∞–≤—á–∞–Ω–Ω—è:* –°–∫–ª–∞–¥—Å—å–∫–∏–π –æ–±–ª—ñ–∫ —Ç–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è
*üí™ –§—ñ–∑–∏—á–Ω–∞:* –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏

*‚ÑπÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è:*
‚Ä¢ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Ö–Ω—ñ–∫–∏ —Ç–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—é
‚Ä¢ –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞–ø–∞—Å—ñ–≤
‚Ä¢ –°–∫–ª–∞–¥–∞–Ω–Ω—è —Å–ø–∏—Å–∫—ñ–≤ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
‚Ä¢ –û–±–ª—ñ–∫ –≤–∏—Ç—Ä–∞—Ç–Ω–æ—ó —Ö—ñ–º—ñ—ó
‚Ä¢ –Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è`,

  mall_worker: `üè¢ *–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫ –Ω–∞ –¢–†–¶*

*üí∂ –ó–∞—Ä–ø–ª–∞—Ç–∞:* –î–æ 1300 –≥—Ä–Ω –∑–∞ –∑–º—ñ–Ω—É
*üìÖ –í–∏–ø–ª–∞—Ç–∏:* 15-–≥–æ –∞–≤–∞–Ω—Å, 8-–≥–æ –∑–∞—Ä–ø–ª–∞—Ç–∞
*‚è∞ –ì—Ä–∞—Ñ—ñ–∫:* 3/2, –∑–º—ñ–Ω–∞ –ø–æ 11 –≥–æ–¥–∏–Ω
*üìç –†–æ–±–æ—Ç–∞:* –°–æ—Ñ—ñ—ó–≤—Å—å–∫–∞ –ë–æ—Ä—â–∞–≥—ñ–≤–∫–∞, –≤—É–ª. –Ø–±–ª—É–Ω–µ–≤–∞, 3
*üìç –û—Ñ—ñ—Å –¥–ª—è —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏:* –≤—É–ª. –ë–∞—Å–µ–π–Ω–∞, 6
*üéΩ –§–æ—Ä–º–∞:* –¢–∞–∫, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ —Ñ–æ—Ä–º–∞ —Ç–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä
*üìö –°—Ç–∞–∂—É–≤–∞–Ω–Ω—è:* –¢–∞–∫, –æ–ø–ª–∞—á—É–≤–∞–Ω–∏–π –¥–µ–Ω—å

*‚ÑπÔ∏è –£–º–æ–≤–∏:*
‚Ä¢ –†–æ–±–æ—Ç–∞ —É –¢–†–¶ "–©–∞—Å–ª–∏–≤–∏–π –ú–æ–ª–ª"
‚Ä¢ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
‚Ä¢ –ö–æ–º–∞–Ω–¥–Ω–∞ —Ä–æ–±–æ—Ç–∞
‚Ä¢ –ù–∞–≤—á–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º`
};

// –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
function getCategoriesKeyboard() {
  const keyboard = [];
  
  // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ 2 –∫–Ω–æ–ø–∫–∏
  for (let i = 0; i < categories.length; i += 2) {
    const row = categories.slice(i, i + 2).map(cat => ({
      text: cat.name,
      callback_data: `category_${cat.id}`
    }));
    keyboard.push(row);
  }
  
  return keyboard;
}

// –ù–∞—á–∞–ª–æ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
async function startCategorySelection(bot, query) {
  try {
    const chatId = query.message.chat.id;
    const userId = query.from.id;
    
    await bot.sendMessage(chatId, 'üëã –í—ñ—Ç–∞—î–º–æ! –û–±–µ—Ä—ñ—Ç—å –≤–∞—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:', {
      reply_markup: {
        inline_keyboard: getCategoriesKeyboard()
      }
    });
  } catch (error) {
    console.error('Error in startCategorySelection:', error);
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
async function handleCategoryCallback(bot, query) {
  try {
    const chatId = query.message.chat.id;
    const userId = query.from.id;
    const categoryId = query.data.replace('category_', '');
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    const selectedCategory = categories.find(cat => cat.id === categoryId);
    
    if (!selectedCategory) {
      await bot.answerCallbackQuery(query.id, { text: '‚ùå –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞' });
      return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫
    const infoMessage = categoryInfo[categoryId];
    
    await bot.sendMessage(chatId, infoMessage, {
      parse_mode: 'Markdown',
      reply_markup: {
        inline_keyboard: [
          [{ text: '‚úÖ –û–∑–Ω–∞–π–æ–º–∏–≤—Å—è', callback_data: `confirm_${categoryId}` }],
          [{ text: 'üîÑ –û–±—Ä–∞—Ç–∏ —ñ–Ω—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é', callback_data: 'change_category' }]
        ]
      }
    });
    
    // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback
    await bot.answerCallbackQuery(query.id, { 
      text: `‚úÖ –í–∏ –æ–±—Ä–∞–ª–∏: ${selectedCategory.name}` 
    });
    
  } catch (error) {
    console.error('Error in handleCategoryCallback:', error);
    try {
      await bot.answerCallbackQuery(query.id, { text: '‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ' });
    } catch (e) {
      console.error('Error answering callback:', e);
    }
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è
async function handleConfirmationCallback(bot, query) {
  try {
    const chatId = query.message.chat.id;
    const userId = query.from.id;
    const categoryId = query.data.replace('confirm_', '');
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    const selectedCategory = categories.find(cat => cat.id === categoryId);
    
    if (!selectedCategory) {
      await bot.answerCallbackQuery(query.id, { text: '‚ùå –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞' });
      return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    userCategories.set(userId, {
      category: selectedCategory.id,
      categoryName: selectedCategory.name,
      selectedAt: new Date()
    });
    
    // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback
    await bot.answerCallbackQuery(query.id, { 
      text: `‚úÖ –ì–æ—Ç–æ–≤–æ! –ü–æ—á–∏–Ω–∞—î–º–æ –∞–Ω–∫–µ—Ç—É` 
    });
    
    // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    try {
      await bot.deleteMessage(chatId, query.message.message_id);
    } catch (deleteError) {
      console.log('Cannot delete message:', deleteError.message);
    }
    
    // –ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∫–µ—Ç—É
    const { startQuestionnaire } = require('./Questionnaire');
    await startQuestionnaire(bot, { 
      message: { chat: { id: chatId } }, 
      from: { id: userId } 
    });
    
  } catch (error) {
    console.error('Error in handleConfirmationCallback:', error);
  }
}

// –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function getUserCategory(userId) {
  return userCategories.get(userId);
}

module.exports = {
  startCategorySelection,
  handleCategoryCallback,
  handleConfirmationCallback,
  getUserCategory,
  userCategories,
  categories
};